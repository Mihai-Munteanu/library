<%
  books = local_assigns[:books] || @books
  pagy = local_assigns[:pagy] || @pagy
  show_author = local_assigns.fetch(:show_author, false)
  title = local_assigns[:title]
  empty_message = local_assigns[:empty_message] || "No books recorded."
%>

<% if title.present? %>
  <div class="mt-8">
    <h2 class="text-2xl font-bold mb-4"><%= title %></h2>
<% end %>

<% if books.any? %>
  <table class="min-w-full bg-white border border-gray-300">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-2 border-b"><%= sortable_column(:title, "Title") %></th>
        <th class="px-4 py-2 border-b"><%= sortable_column(:isbn, "ISBN") %></th>
        <th class="px-4 py-2 border-b">Description</th>
        <th class="px-4 py-2 border-b"><%= sortable_column(:publication_date, "Publication Date") %></th>
        <th class="px-4 py-2 border-b"><%= sortable_column(:copies_sold, "Copies Sold") %></th>
        <th class="px-4 py-2 border-b"><%= sortable_column(:price, "Price") %></th>
        <th class="px-4 py-2 border-b"><%= sortable_column(:pages, "Pages") %></th>
        <% if show_author %>
          <th class="px-4 py-2 border-b">Author</th>
        <% end %>
        <th class="px-4 py-2 border-b">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% books.each do |book| %>
        <tr id="book_<%= book.id %>">
          <td class="px-4 py-2 border-b"><%= book.title %></td>
          <td class="px-4 py-2 border-b"><%= book.isbn %></td>
          <td class="px-4 py-2 border-b"><%= book.description %></td>
          <td class="px-4 py-2 border-b"><%= book.publication_date %></td>
          <td class="px-4 py-2 border-b"><%= book.copies_sold %></td>
          <td class="px-4 py-2 border-b"><%= book.price %></td>
          <td class="px-4 py-2 border-b"><%= book.pages %></td>
          <% if show_author %>
            <td class="px-4 py-2 border-b"><%= link_to book.author.name, author_path(book.author), class: "text-blue-500 hover:underline" %></td>
          <% end %>
          <td class="px-4 py-2 border-b">
            <%= link_to "Show", book, class: "text-blue-500 hover:underline mr-2" %>
            <%= link_to "Edit", edit_book_path(book), class: "text-green-500 hover:underline mr-2" %>
            <%= link_to "Delete", book_path(book),
                data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                class: "text-red-500 hover:underline" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if pagy && pagy.pages > 1 %>
    <div class="mt-6 flex justify-center">
      <%== pagy.series_nav %>
    </div>
  <% end %>
<% else %>
  <p class="text-gray-500"><%= empty_message %></p>
<% end %>

<% if title.present? %>
  </div>
<% end %>

