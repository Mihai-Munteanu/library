<%
  # Prepare basic information fields
  basic_fields = [
    { label: "Name", value: @author.name },
    { label: "Nationality", value: @author.nationality || "N/A" },
    { label: "Gender", value: @author.gender&.humanize || "N/A" },
    { label: "Birth Date", value: @author.birth_date || "N/A" },
    { label: "Death Date", value: @author.death_date || "N/A" },
    {
      label: "Biography",
      value: @author.biography.present? ? simple_format(@author.biography) : content_tag(:span, "No biography available.", class: "text-gray-400 italic"),
      col_span: "sm:col-span-2 lg:col-span-3",
      value_class: "text-base text-gray-900 leading-relaxed"
    }
  ]

  # Prepare metadata fields if present
  metadata = @author.metadata || {}
  metadata_fields = []
  if metadata.values.any?(&:present?)
    metadata_fields << { label: "Website", value: link_to(metadata["website"], metadata["website"], target: "_blank", rel: "noopener noreferrer", class: "text-blue-600 hover:text-blue-800 hover:underline") } if metadata["website"].present?
    metadata_fields << { label: "Email", value: mail_to(metadata["email"], metadata["email"], class: "text-blue-600 hover:text-blue-800 hover:underline") } if metadata["email"].present?
    metadata_fields << { label: "Twitter", value: link_to(metadata["twitter"], "https://twitter.com/#{metadata["twitter"].gsub(/^@/, '')}", target: "_blank", rel: "noopener noreferrer", class: "text-blue-600 hover:text-blue-800 hover:underline") } if metadata["twitter"].present?
    metadata_fields << { label: "Facebook", value: link_to(metadata["facebook"], metadata["facebook"], target: "_blank", rel: "noopener noreferrer", class: "text-blue-600 hover:text-blue-800 hover:underline") } if metadata["facebook"].present?

    if metadata["tags"].present?
      tags = metadata["tags"].is_a?(Array) ? metadata["tags"] : metadata["tags"].to_s.split(",").map(&:strip)
      tags_html = content_tag(:div, class: "flex flex-wrap gap-2") do
        safe_join(tags.map { |tag| content_tag(:span, tag.to_s.strip, class: "inline-block bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full") })
      end
      metadata_fields << { label: "Tags", value: tags_html, col_span: "sm:col-span-2" }
    end

    metadata_fields << { label: "Notes", value: simple_format(metadata["notes"]), col_span: "sm:col-span-2", value_class: "text-base text-gray-900 leading-relaxed" } if metadata["notes"].present?
  end

  # Prepare details sections
  details_sections = [
    {
      title: "Basic Information",
      fields: basic_fields
    }
  ]

  details_sections << {
    title: "Additional Information",
    fields: metadata_fields,
    grid_cols: "grid-cols-1 sm:grid-cols-2"
  } if metadata_fields.any?
%>
<%= render "shared/show_page",
    resource: @author,
    title: @author.name,
    index_path: authors_path,
    edit_path: edit_author_path(@author),
    delete_confirmation_path: delete_confirmation_author_path(@author, from_page: "show"),
    details_sections: details_sections,
    related_sections: [
      {
        title: "Books by #{@author.name}",
        new_path: new_book_path(author_id: @author.id),
        new_text: "Add New Book",
        partial: "authors/books_table_frame",
        locals: {}
      }
    ] %>
